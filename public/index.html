<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>命运轮盘 - Fate Roulette</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="mobile.css">
</head>

<body>
    <!-- Theme Toggle -->
    <button class="theme-toggle" onclick="toggleTheme()" title="切换主题">
        🌓
    </button>

    <!-- Main Menu -->
    <div id="mainMenu" class="screen active">
        <div class="title-container">
            <h1 class="game-title">命运轮盘</h1>
            <div class="game-subtitle">FATE ROULETTE</div>
        </div>

        <div class="menu-options">
            <button class="btn btn-primary" onclick="showModeSelection()">开始游戏</button>
            <button class="btn" onclick="showRules()">游戏规则</button>
            <button class="btn" onclick="showStats()">战绩统计</button>
        </div>
    </div>

    <!-- Mode Selection -->
    <div id="modeSelection" class="screen">
        <button class="btn btn-back" onclick="showMainMenu()">← 返回</button>
        <h2 class="modal-title">选择模式</h2>
        <div class="menu-options">
            <button class="btn" onclick="showAIDifficulty()">单机挑战 (AI)</button>
            <button class="btn btn-primary" onclick="showMultiplayerOptions()">多人联机</button>
        </div>
    </div>

    <!-- AI Difficulty -->
    <div id="aiDifficulty" class="screen">
        <button class="btn btn-back" onclick="showModeSelection()">← 返回</button>
        <h2 class="modal-title">选择难度</h2>
        <div class="menu-options">
            <button class="btn" onclick="startAIGame('hard')">困难</button>
            <button class="btn" onclick="startAIGame('expert')">专家</button>
            <button class="btn" onclick="startAIGame('hell')">地狱</button>
        </div>
    </div>

    <!-- Multiplayer Options -->
    <div id="multiplayerOptions" class="screen">
        <button class="btn btn-back" onclick="showModeSelection()">← 返回</button>
        <h2 class="modal-title">多人联机</h2>
        <div class="menu-options">
            <button class="btn" onclick="createRoom()">创建房间</button>
            <button class="btn" onclick="showJoinRoom()">加入房间</button>
            <button class="btn btn-primary" onclick="quickMatch()">快速匹配</button>
        </div>
    </div>

    <!-- Join Room -->
    <div id="joinRoomScreen" class="screen">
        <button class="btn btn-back" onclick="showMultiplayerOptions()">← 返回</button>
        <h2 class="modal-title">加入房间</h2>
        <div class="menu-options">
            <input type="text" id="roomIdInput" class="btn" placeholder="输入房间号"
                style="text-align: center; cursor: text; background: var(--bg-card);">
            <input type="text" id="playerNameInput" class="btn" placeholder="输入你的名字"
                style="text-align: center; cursor: text; background: var(--bg-card);">
            <button class="btn btn-primary" onclick="joinRoomWithId()">加入</button>
        </div>
    </div>

    <!-- Waiting Room -->
    <div id="waitingRoom" class="screen">
        <button class="btn btn-back" onclick="leaveRoom()">← 离开</button>
        <h2 class="modal-title">等待对手</h2>
        <div style="text-align: center; width: 100%; max-width: 400px;">
            <p style="color: var(--text-secondary); margin-bottom: 10px;">房间号</p>
            <div class="room-id-display">
                <span id="displayRoomId" class="room-id-text">------</span>
                <button class="btn btn-icon" onclick="copyRoomId()" title="复制房间号">📋</button>
            </div>
            <div style="color: var(--text-muted); font-size: 0.9rem; margin-top: 20px;">
                正在等待另一位玩家加入...
            </div>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="gameScreen" class="screen">
        <div class="game-container">
            <!-- Opponent Area -->
            <div class="player-area opponent-area" id="opponentArea">
                <div class="player-header">
                    <div class="player-info">
                        <div class="player-name" id="opponentName">对手</div>
                        <div class="status-row" id="opponentStatus"></div>
                    </div>
                    <div class="hp-bar" id="opponentHpBar"></div>
                </div>
                <div class="spirits-row" id="opponentSpirits"></div>
            </div>

            <!-- Center Area -->
            <div class="center-area">
                <div class="deck-area">
                    <div class="deck-card">
                        🎴
                        <div class="deck-count" id="fateDeckCount">8</div>
                    </div>
                    <div style="color: var(--text-muted); font-size: 0.8rem;">命运牌堆</div>
                </div>

                <div style="text-align: center;">
                    <div id="turnIndicator" class="turn-badge">等待开始...</div>
                </div>

                <div class="game-log" id="gameLog">
                    <div class="log-entry">欢迎来到命运轮盘</div>
                </div>
            </div>

            <!-- Player Area -->
            <div class="player-area self-area" id="playerArea">
                <div class="spirits-row" id="playerSpirits"></div>
                <div class="player-header" style="margin-top: 16px; margin-bottom: 0;">
                    <div class="player-info">
                        <div class="player-name" id="playerName">玩家</div>
                        <div class="status-row" id="playerStatus"></div>
                    </div>
                    <div class="hp-bar" id="playerHpBar"></div>
                </div>
            </div>
        </div>

        <div class="action-bar">
            <button class="btn" onclick="showRulesInGame()" style="margin-right: auto;">📖 规则</button>
            <button class="btn btn-primary btn-fate" onclick="useFateCard()">使用命运卡牌</button>
            <button class="btn btn-danger" onclick="leaveRoom()" style="margin-left: auto;">离开</button>
        </div>
    </div>

    <!-- Rules Screen -->
    <div id="rulesScreen" class="screen scrollable">
        <button class="btn btn-back" onclick="showMainMenu()">← 返回</button>
        <div
            style="max-width: 900px; width: 90%; background: var(--bg-card); padding: 40px; border-radius: var(--radius-lg); border: 1px solid var(--border-color); margin: 40px auto;">
            <h2 class="modal-title" style="text-align: center;">游戏规则</h2>

            <div style="text-align: left; line-height: 1.8; color: var(--text-secondary);">
                <h3
                    style="color: var(--text-primary); margin: 20px 0 10px; border-bottom: 1px solid var(--border-color); padding-bottom: 5px;">
                    🎯 核心规则</h3>
                <ul style="padding-left: 20px; margin-bottom: 20px;">
                    <li><strong>获胜条件</strong>：将对手的生命值降至 <strong>0</strong> 或以下。</li>
                    <li><strong>生命值</strong>：初始 4 点，上限 5 点。</li>
                    <li><strong>受伤补偿</strong>：每次失去生命值，你会获得 <strong>2个灵物</strong>。</li>
                    <li><strong>灵物上限</strong>：最多持有 5 个灵物。</li>
                    <li><strong>回合流程</strong>：
                        <ol>
                            <li>使用任意数量灵物（除非被【手铐】限制）。</li>
                            <li>点击"使用命运卡牌"结束回合（抽一张牌并结算）。</li>
                        </ol>
                    </li>
                </ul>

                <h3
                    style="color: var(--text-primary); margin: 20px 0 10px; border-bottom: 1px solid var(--border-color); padding-bottom: 5px;">
                    ✨ 灵物图鉴 (详细效果)</h3>
                <div class="rules-grid">
                    <div class="rule-card">
                        <div><strong>🛡️ 护身符 (隐藏)</strong></div>
                        <div style="font-size: 0.8rem; margin-top: 4px;">
                            接下来的2个回合内，受到的第1点伤害无效。若单次受到超过1点伤害，护符破碎并受到双倍伤害。对手无法看到你使用了此物品。</div>
                    </div>
                    <div class="rule-card">
                        <div><strong>🪞 镜子 (隐藏)</strong></div>
                        <div style="font-size: 0.8rem; margin-top: 4px;">
                            直到下个回合开始前，反弹下一次指向你的命运卡牌效果给对手，且反弹伤害+1。对手无法看到你使用了此物品。</div>
                    </div>
                    <div class="rule-card">
                        <div><strong>📡 遥控器</strong></div>
                        <div style="font-size: 0.8rem; margin-top: 4px;">在你回合结束后，对手被迫对自己使用牌堆顶的一张命运卡牌。</div>
                    </div>
                    <div class="rule-card">
                        <div><strong>🧹 橡皮擦</strong></div>
                        <div style="font-size: 0.8rem; margin-top: 4px;">随机移除对手最多 2 个灵物。</div>
                    </div>
                    <div class="rule-card">
                        <div><strong>🧤 手套</strong></div>
                        <div style="font-size: 0.8rem; margin-top: 4px;">选择并偷取对手 1 个灵物（无法偷取手套）。</div>
                    </div>
                    <div class="rule-card">
                        <div><strong>💚 绿药水</strong></div>
                        <div style="font-size: 0.8rem; margin-top: 4px;">恢复 1 点生命值。</div>
                    </div>
                    <div class="rule-card">
                        <div><strong>✨ 无中生有</strong></div>
                        <div style="font-size: 0.8rem; margin-top: 4px;">获得 2 个随机灵物。</div>
                    </div>
                    <div class="rule-card">
                        <div><strong>🍄 蘑菇</strong></div>
                        <div style="font-size: 0.8rem; margin-top: 4px;">你下一次抽取的命运卡牌将被替换为一张完全随机的卡牌。</div>
                    </div>
                    <div class="rule-card">
                        <div><strong>🤍 白药水</strong></div>
                        <div style="font-size: 0.8rem; margin-top: 4px;">49%回1血，49%扣1血，1%回2血，1%扣2血。</div>
                    </div>
                    <div class="rule-card">
                        <div><strong>🔀 洗牌器</strong></div>
                        <div style="font-size: 0.8rem; margin-top: 4px;">你下一次抽取的牌将与牌堆中随机一张牌交换位置。</div>
                    </div>
                    <div class="rule-card">
                        <div><strong>🔍 放大镜</strong></div>
                        <div style="font-size: 0.8rem; margin-top: 4px;">查看牌堆顶的第一张牌。</div>
                    </div>
                    <div class="rule-card">
                        <div><strong>❤️ 红药水</strong></div>
                        <div style="font-size: 0.8rem; margin-top: 4px;">你的下一张造成伤害的命运卡牌，伤害+1。</div>
                    </div>
                    <div class="rule-card">
                        <div><strong>⛓️ 手铐</strong></div>
                        <div style="font-size: 0.8rem; margin-top: 4px;">对手下回合无法使用灵物（对手获得1灵物补偿）。</div>
                    </div>
                    <div class="rule-card">
                        <div><strong>📞 电话</strong></div>
                        <div style="font-size: 0.8rem; margin-top: 4px;">查看牌堆中指定位置的一张牌。</div>
                    </div>
                    <div class="rule-card">
                        <div><strong>🛏️ 枕头</strong></div>
                        <div style="font-size: 0.8rem; margin-top: 4px;">获得3个灵物，跳过下个回合。2回合内免疫【手铐】。</div>
                    </div>
                    <div class="rule-card">
                        <div><strong>📜 契约书</strong></div>
                        <div style="font-size: 0.8rem; margin-top: 4px;">扣2血。下次生命归零时以1血存活，获得最终回合和3灵物。若最终回合未胜则败。</div>
                    </div>
                    <div class="rule-card">
                        <div><strong>📻 无线电</strong></div>
                        <div style="font-size: 0.8rem; margin-top: 4px;">强制对手使用他的一个灵物（目标由你指定）。</div>
                    </div>
                </div>

                <h3
                    style="color: var(--text-primary); margin: 20px 0 10px; border-bottom: 1px solid var(--border-color); padding-bottom: 5px;">
                    🎴 命运卡牌图鉴</h3>
                <div class="rules-grid">
                    <div class="rule-card">
                        <div><strong>⚡ 天罚</strong></div>
                        <div style="font-size: 0.8rem; margin-top: 4px;">对目标造成 1 点伤害。</div>
                    </div>
                    <div class="rule-card">
                        <div><strong>🎁 恩赐</strong></div>
                        <div style="font-size: 0.8rem; margin-top: 4px;">目标获得 1 个灵物。</div>
                    </div>
                    <div class="rule-card">
                        <div><strong>🌌 虚无</strong></div>
                        <div style="font-size: 0.8rem; margin-top: 4px;">无事发生。若对自己使用，获得额外回合。</div>
                    </div>
                    <div class="rule-card">
                        <div><strong>🔄 轮回</strong></div>
                        <div style="font-size: 0.8rem; margin-top: 4px;">目标立即对自己使用牌堆顶的下一张牌。</div>
                    </div>
                    <div class="rule-card">
                        <div><strong>💢 反噬</strong></div>
                        <div style="font-size: 0.8rem; margin-top: 4px;">对目标造成 1 点伤害。若造成伤害，目标获得额外回合。</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Screen -->
    <div id="statsScreen" class="screen">
        <button class="btn btn-back" onclick="showMainMenu()">← 返回</button>
        <h2 class="modal-title">战绩统计</h2>
        <div style="display: flex; gap: 40px; text-align: center; margin-bottom: 30px;">
            <div
                style="background: var(--bg-card); padding: 20px 40px; border-radius: var(--radius-lg); border: 1px solid var(--border-color);">
                <div style="font-size: 3rem; color: var(--accent-success); font-weight: bold;" id="winCount">0</div>
                <div style="color: var(--text-secondary);">胜利</div>
            </div>
            <div
                style="background: var(--bg-card); padding: 20px 40px; border-radius: var(--radius-lg); border: 1px solid var(--border-color);">
                <div style="font-size: 3rem; color: var(--accent-secondary); font-weight: bold;" id="lossCount">0</div>
                <div style="color: var(--text-secondary);">失败</div>
            </div>
        </div>
        <div style="font-size: 1.2rem; color: var(--text-primary);">
            胜率: <span id="winRate" style="color: var(--accent-primary); font-weight: bold;">0%</span>
        </div>
    </div>

    <!-- Modals -->
    <div id="targetModal" class="modal">
        <div class="modal-content">
            <h3 class="modal-title">选择目标</h3>
            <div style="display: flex; gap: 20px; justify-content: center;">
                <button class="btn" onclick="selectTarget('self')">自己</button>
                <button class="btn btn-primary" onclick="selectTarget('opponent')">对手</button>
            </div>
        </div>
    </div>

    <div id="gameOverModal" class="modal">
        <div class="modal-content">
            <h3 class="modal-title" id="gameOverTitle">游戏结束</h3>
            <p id="gameOverMessage" class="modal-body">...</p>
            <button class="btn btn-primary" onclick="returnToMenu()">返回主菜单</button>
        </div>
    </div>

    <script src="game.js"></script>
</body>

</html>